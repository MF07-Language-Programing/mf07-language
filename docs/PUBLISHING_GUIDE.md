# Publishing & Installation Guide

## For Developers: Publishing New Versions

### Option 1: Standard Flow (with PR)

```bash
# Auto-detect version bump from commits
mf publish

# Explicit version bump
mf publish --major  # 1.0.0 -> 2.0.0
mf publish --minor  # 1.0.0 -> 1.1.0
mf publish --patch  # 1.0.0 -> 1.0.1

# With custom message
mf publish --minor -m "Add new feature X"

# Skip confirmation
mf publish --patch --yes
```

Then create a **PR** on GitHub from `release/vX.Y.Z` to `main`.

### Option 2: Manual Release (without PR)

If you can't create PRs directly to main:

1. Go to **Actions** tab on GitHub
2. Select **"Manual Release"** workflow
3. Click **"Run workflow"**
4. Enter the version (e.g., `1.1.2`)
5. Choose if you want to update `pyproject.toml`
6. Click **"Run workflow"**

GitHub Actions will automatically:
- âœ“ Validate version format
- âœ“ Create/update version
- âœ“ Run tests
- âœ“ Create tag `vX.Y.Z`
- âœ“ Generate GitHub Release
- âœ“ Update documentation
- âœ“ Deploy to GitHub Pages

**No PR needed!** ðŸš€

### What Happens

1. **Version Calculation**: Analyzes commits or uses specified bump type
2. **Branch Creation**: Creates `release/vX.Y.Z` branch
3. **Version Update**: Updates `pyproject.toml` automatically
4. **Git Operations**: Commits, tags, and pushes to remote
5. **CI/CD Trigger**: GitHub Actions starts automatically
6. **Release Pipeline**:
   - Runs tests
   - Builds distribution packages
   - Publishes to PyPI
   - Creates GitHub Release
   - Updates documentation
   - Deploys to GitHub Pages

### Commit Message Convention

For auto-detection to work optimally:

- `feat:` or `feature:` â†’ **minor** bump
- `fix:` or `patch:` â†’ **patch** bump
- `BREAKING CHANGE:` or `!:` â†’ **major** bump

Example:
```bash
git commit -m "feat: add async runtime support"
mf publish  # Will suggest minor bump
```

### Manual Override

```bash
# Local only (no push)
mf publish --patch --skip-push

# Then manually:
git push -u origin release/v1.2.3
git push origin v1.2.3
```

### Requirements

- Clean working tree (no uncommitted changes)
- Git repository initialized
- GitHub repository configured
- Repository write access

---

## For Users: Installing MF07

### One-Line Install (Recommended)

**Linux / macOS:**
```bash
curl -fsSL https://raw.githubusercontent.com/MF07-Language-Programing/mf07-language/main/install.sh | bash
```

**Windows (Git Bash / WSL):**
```bash
wget -qO- https://raw.githubusercontent.com/MF07-Language-Programing/mf07-language/main/install.sh | bash
```

### Manual Install via pip

```bash
# Install from source
git clone https://github.com/MF07-Language-Programing/mf07-language.git
cd mf07-language
pip install -e .
```

### Verify Installation

```bash
mf --version
mf init myproject
cd myproject
mf run main.mp
```

### Install Script Features

- âœ… Multi-platform (Linux, macOS, Windows via Git Bash/WSL)
- âœ… Auto-detects Python installation
- âœ… Configures shell PATH automatically
- âœ… Version management built-in
- âœ… Rollback support

### Environment Variables

```bash
# Custom install directory
export MF_INSTALL_DIR=$HOME/.local/mf
curl -fsSL ... | bash

# Install specific version
export MF_VERSION=0.1.0
curl -fsSL ... | bash

# Custom repository
export MF_REPO_OWNER=your-org
export MF_REPO_NAME=your-repo
curl -fsSL ... | bash
```

---

## CI/CD Configuration

### Required GitHub Secrets

Set these in your repository settings (`Settings > Secrets and variables > Actions`):

| Secret | Description | Required |
|--------|-------------|----------|
| `GITHUB_TOKEN` | Auto-generated by GitHub | âœ… Auto |
| `PAGES_PAT` | Personal Access Token for Pages | Optional |

### Workflow Overview

**File**: `.github/workflows/release.yml`

**Trigger**: Push of tag matching `v*.*.*` pattern

**Jobs**:
1. `validate` - Version format validation
2. `test` - Run full test suite
3. `build` - Create distribution packages and archives
4. `create-release` - GitHub Release with changelog and binaries
5. `update-docs` - Update version in documentation
6. `deploy-pages` - Deploy to GitHub Pages
7. `notify` - Status reporting

---

## Version Management

### Version Structure

Follows [Semantic Versioning 2.0.0](https://semver.org/):

```
MAJOR.MINOR.PATCH[-PRERELEASE]
  â”‚     â”‚     â”‚        â”‚
  â”‚     â”‚     â”‚        â””â”€ Optional: alpha, beta, rc.1
  â”‚     â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Bug fixes, patches
  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ New features (backwards compatible)
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Breaking changes
```

### Pre-release Versions

```bash
# Not yet supported via CLI, manual tagging required
git tag -a v1.0.0-beta.1 -m "Beta release"
git push origin v1.0.0-beta.1
```

### Rollback

```bash
# Install specific version from GitHub
export MF_VERSION=0.9.0
curl -fsSL https://raw.githubusercontent.com/MF07-Language-Programing/mf07-language/main/install.sh | bash
```

---

## Security Best Practices

### For Publishers

1. **Never commit secrets** - Use GitHub Secrets
2. **Enable branch protection** - Require PR reviews for `main`
3. **Sign commits** - Use GPG signatures
4. **Audit dependencies** - Regular security checks
5. **Two-factor auth** - Enable on GitHub

### For Consumers

1. **Verify checksums** - Compare SHA256SUMS from releases
2. **Pin versions** - Use specific version tags in production
3. **Review changelogs** - Check release notes before upgrading
4. **Test in staging** - Don't upgrade production directly

---

## Troubleshooting

### Publish Fails

```bash
# Check working tree is clean
git status

# Verify remote is configured
git remote -v

# Check GitHub token permissions
gh auth status
```

### Install Script Fails

```bash
# Install dependencies manually
sudo apt install python3 python3-pip git  # Ubuntu/Debian
brew install python3 git                  # macOS

# Clone and install from source
git clone https://github.com/MF07-Language-Programing/mf07-language.git
cd mf07-language
pip3 install --user -e .
```

### CLI Not Found After Install

```bash
# Reload shell configuration
source ~/.bashrc  # or ~/.zshrc, ~/.bash_profile

# Or add to PATH manually
export PATH="$PATH:$HOME/.mf/bin"

# Verify Python user bin is in PATH
echo $PATH | grep -o "$(python3 -m site --user-base)/bin"
```

---

## Future Enhancements

- ðŸŽ¯ Custom domain for installation (`curl install.mf07.dev | bash`)
- ðŸŽ¯ Homebrew formula (`brew install mf07`)
- ðŸŽ¯ Docker images
- ðŸŽ¯ VS Code extension auto-updater
- ðŸŽ¯ Canary/nightly builds
- ðŸŽ¯ Rollback command (`mf upgrade --rollback`)

---

## Support

- **Issues**: https://github.com/MF07-Language-Programing/mf07-language/issues
- **Discussions**: https://github.com/MF07-Language-Programing/mf07-language/discussions
- **Security**: security@mf07.dev (when available)
